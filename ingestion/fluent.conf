# Entrada por UDP en 24224
<source>
  @type udp
  port 24224
  bind 0.0.0.0
  @log_level info
  <parse>
    @type none
  </parse>
</source>

# Transformaci√≥n simple para normalizar campos
<filter **>
  @type record_transformer
  enable_ruby true
  <record>
    message ${record["message"]}
    tag ${tag}
    time ${Time.at(time).utc.iso8601}
  </record>
</filter>

# Salida a RabbitMQ usando variables del entorno de docker-compose
<match **>
  @type rabbitmq

  host "#{ENV['RABBITMQ_HOST'] || 'rabbitmq'}"
  port 5672
  user "#{ENV['RABBITMQ_USER'] || 'admin'}"
  password "#{ENV['RABBITMQ_PASSWORD'] || 'securepass'}"

  exchange "#{ENV['RABBITMQ_EXCHANGE'] || 'logs_default'}"
  exchange_type "topic"
  routing_key "#{ENV['RABBITMQ_ROUTING_KEY'] || 'nubla.log.default'}"
  persistent true

  serializer json

  heartbeat 5
  max_retries 10
  retry_interval 2
</match>